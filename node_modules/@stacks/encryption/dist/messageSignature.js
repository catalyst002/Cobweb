"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.decodeMessage = exports.encodeMessage = exports.hashMessage = void 0;
const sha256_1 = require("@noble/hashes/sha256");
const common_1 = require("@stacks/common");
const varuint_1 = require("./varuint");
const chainPrefix = '\x17Stacks Signed Message:\n';
function hashMessage(message, prefix = chainPrefix) {
    return (0, sha256_1.sha256)(encodeMessage(message, prefix));
}
exports.hashMessage = hashMessage;
function encodeMessage(message, prefix = chainPrefix) {
    const messageBytes = typeof message == 'string' ? (0, common_1.utf8ToBytes)(message) : message;
    const encodedLength = (0, varuint_1.encode)(messageBytes.length);
    return (0, common_1.concatBytes)((0, common_1.utf8ToBytes)(prefix), encodedLength, messageBytes);
}
exports.encodeMessage = encodeMessage;
function decodeMessage(encodedMessage, prefix = chainPrefix) {
    const prefixByteLength = (0, common_1.utf8ToBytes)(prefix).byteLength;
    const messageWithoutChainPrefix = encodedMessage.subarray(prefixByteLength);
    const decoded = (0, varuint_1.decode)(messageWithoutChainPrefix);
    const varIntLength = (0, varuint_1.encodingLength)(decoded);
    return messageWithoutChainPrefix.slice(varIntLength);
}
exports.decodeMessage = decodeMessage;
//# sourceMappingURL=messageSignature.js.map